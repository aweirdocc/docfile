---
title: 前端工程
titleTemplate: 工程化基础（二）
description: PNPM 基础知识汇总
tag: pnpm
---

## **npm3 与 yarn 存在的问题（扁平结构）**

### 结构的不确定性
因为同一目录下不能出现两个同名的文件，所以如果依赖于同一个包的不同版本，那么有一个版本注定还是要被嵌套依赖。

### 幽灵依赖
文件被铺平，`require`一些子集依赖的时候，由于在`node_modules`的同一级，导致它是可以被引用到的；如果这个包以后缺失的话，会导致报错；	


### 复杂度高，处理耗时
依赖了很多很多包的时候，我们会明显的感觉到，npm的依赖安装变慢了。


## pnpm的特点

### 更高效的利用磁盘空间
pnpm 在执行`install`命令的时候， 会在当前磁盘的根目录创建一个全局store(`.pnpm-store`)，在项目目录创建一个虚拟 store(`node_modules/.pnpm`) 。

`node_modules`下只有一级依赖的软链接，如果你在项目中直接去引用二级依赖包的话，会报错，直接找不到 ；
所有的子依赖都在`**.pnpm**`这里铺平了，都是从全局 store **硬链接**过来的，然后包和包之间的依赖关系是通过**软链接**组织的。

"**基于内容寻址**"的文件系统，采用硬链接的方式去索引那一块磁盘空间，依赖都只会在磁盘中写入一次。
一个包在全局只保存一份，剩下的都是软硬连接，这会大量节省磁盘空间。

### 更快速的依赖下载
因为通过链接的方式而不是复制，在查询与操作的时候非常快。


